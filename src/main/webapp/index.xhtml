<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="https://jakarta.ee/xml/ns/jakartaee/jsf/html"
      xmlns:f="https://jakarta.ee/xml/ns/jakartaee/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <h:outputStylesheet name="css/mycsslayout.css"/>
    <h:outputScript name="js/script.js" target="head"/>
    <title>TP4 - RAG Avancé</title>
</h:head>
<h:body>
    <f:view>

        <!-- Formulaire d'upload PDF -->
        <h:form id="pdfform" enctype="multipart/form-data">
            <p:panel header="Ajouter un document PDF au RAG">
                <h:panelGrid columns="3">
                    <h:outputLabel for="file" value="Choisissez un fichier PDF local :"/>
                    <h:inputFile id="file" value="#{bb.fichier}"/>
                    <h:message for="file" errorStyle="color: red"/>
                </h:panelGrid>

                <h:commandButton value="Upload du fichier local" action="#{bb.upload}"/>

                <h:outputText value="#{bb.messagePourChargementFichier}"
                              style="color: #{bb.messagePourChargementFichier.startsWith('Erreur') ? 'red' : 'green'}"
                              rendered="#{not empty bb.messagePourChargementFichier}"/>
            </p:panel>
        </h:form>

        <hr/>

        <h:messages errorStyle="color: red" showDetail="true" showSummary="false" globalOnly="true"/>

        <!-- Formulaire Chat RAG -->
        <h:form id="form">
            <p:panel header="Chat avec RAG (Web + Documents)">
                <p:outputLabel for="rolesysteme" value="Rôle de l'API : "/>
                <p:selectOneMenu id="rolesysteme" value="#{bb.roleSysteme}" editable="true"
                                 required="true" requiredMessage="Vous devez indiquer le rôle de l'API"
                                 disabled="#{! bb.roleSystemeChangeable}">
                    <f:selectItems value="#{bb.rolesSysteme}"/>
                </p:selectOneMenu>
                <h:message for="rolesysteme" errorStyle="color: red" />
                <h:commandButton value="Nouveau chat" action="#{bb.nouveauChat}" />

                <h:panelGrid id="paneltotal" columns="2" columnClasses="topAligned,topAligned" style="margin-top: 10px;">
                    <h:panelGrid id="panelgauche" columns="1">
                        <h:panelGrid id="questionetreponse" columns="1">
                            <h:panelGroup>
                                <h:outputText value="Question :"/>
                                <button type="button" onclick="copyToClipboard('question')">Copier question</button>
                                <button type="button" onclick="toutEffacer()">Effacer question et réponse</button>
                            </h:panelGroup>
                            <h:inputTextarea id="question" value="#{bb.question}" title="Question"
                                             cols="50" rows="5"/>
                            <h:commandButton value="Envoyer la question" action="#{bb.envoyer}"/>
                            <h:panelGroup>
                                <h:outputText value="Réponse :"/>
                                <button type="button" onclick="copyToClipboard('reponse')">Copier réponse</button>
                            </h:panelGroup>
                            <h:inputTextarea id="reponse" value="#{bb.reponse}" title="Réponse"
                                             cols="50" rows="15"/>
                        </h:panelGrid>
                    </h:panelGrid>

                    <h:panelGrid id="paneldroit" columns="1" style="vertical-align: top;">
                        <h:panelGroup>
                            <h:outputText value="Conversation :"/>
                            <button type="button" onclick="copyToClipboard('conversation')">Copier conversation</button>
                        </h:panelGroup>
                        <h:inputTextarea id="conversation" rows="30" cols="50" readonly="true"
                                         value="#{bb.conversation}" title="Conversation entière"/>
                    </h:panelGrid>
                </h:panelGrid>
            </p:panel>
        </h:form>

    </f:view>
</h:body>
</html>
